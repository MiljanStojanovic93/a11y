import{_ as h}from"./nuxt-link.9e88655f.js";import{d as B,a as y,r as g,b as m,o as i,q as A,g as o,e as s,j as p,c as r,t as I,f as a,v as n,F as N}from"./entry.bde0faaf.js";import{o as T}from"./time.9f250bef.js";const $={"aria-live":"polite"},D={key:0,class:"flex min-h-[200px] items-center justify-center"},F={key:0},P={class:"mb-3"},S={class:"block whitespace-pre-line rounded-md bg-gray-100 p-4"},V={key:1},E={class:"mb-6 text-center text-lg"},R=B({__name:"AuditProcessingDialog",props:{auditId:{}},emits:["close"],setup(w){const x=w,d=y(),u=g(!1),l=g(),c=d.channel("table-db-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"axe"},t=>{var e;t.new.audit_id===x.auditId&&(t.new.errors&&(l.value=(e=t.new.errors[0])==null?void 0:e.message),u.value=!0,d.removeChannel(c),clearTimeout(k))}).subscribe(),k=setTimeout(()=>{d.removeChannel(c),l.value="Something went wrong, test malformed.",u.value=!0},15*T);return(t,e)=>{const f=m("Button"),b=h,v=m("ProgressBar"),_=m("Dialog");return i(),A(_,{modal:"",class:"w-full max-w-xl","dismissable-mask":""},{header:o(()=>e[2]||(e[2]=[s("h2",{class:"font-medium"},"New audit processing",-1)])),default:o(()=>[s("div",$,[p(u)?(i(),r("div",D,[p(l)?(i(),r("div",F,[s("p",P,[e[3]||(e[3]=s("span",{class:"mb-3 block text-center text-lg text-red-700"}," Oops, something went wrong: ",-1)),s("span",S,I(p(l)),1)]),a(f,{class:"!block !w-full",outlined:"",onClick:e[0]||(e[0]=C=>t.$emit("close",{resetAuditForm:!1}))},{default:o(()=>e[4]||(e[4]=[n(" Repeat audit ")])),_:1})])):(i(),r("div",V,[e[6]||(e[6]=s("p",{class:"mb-6 text-center text-lg"}," Automatic tests finished successfully! ",-1)),a(b,{class:"p-button !block",to:`/audit/${t.auditId}`},{default:o(()=>e[5]||(e[5]=[n(" View audit results ")])),_:1},8,["to"])]))])):(i(),r(N,{key:1},[s("p",E,[e[8]||(e[8]=n(" Your audit has been initiated and is currently being processed. Please wait a few minutes for automatic tests results to be generated. A link to the audit results will be provided here and in the ")),a(b,{to:"/audit"},{default:o(()=>e[7]||(e[7]=[n("Audit List")])),_:1}),e[9]||(e[9]=n(". "))]),a(v,{class:"mb-3",mode:"indeterminate"}),a(f,{class:"!block !w-full",text:"",onClick:e[1]||(e[1]=C=>t.$emit("close"))},{default:o(()=>e[10]||(e[10]=[n(" Create another audit in the meantime ")])),_:1})],64))])]),_:1})}}});export{R as default};
