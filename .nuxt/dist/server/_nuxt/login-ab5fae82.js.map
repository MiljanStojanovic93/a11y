{"version":3,"file":"login-ab5fae82.js","sources":["../../../../pages/login.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport type { InvalidSubmissionContext } from 'vee-validate'\nimport { useForm } from 'vee-validate'\nimport { useToast } from 'primevue/usetoast'\nimport { displayFirstError } from 'utils/form'\n\nimport { signInSchema } from 'validation/schema'\n\ndefinePageMeta({\n  layout: 'simple',\n})\nconst user = useSupabaseUser()\nconst { auth } = useSupabaseClient()\nconst toast = useToast()\n\nconst { useFieldModel, handleSubmit, errors, submitCount } = useForm({\n  validationSchema: signInSchema,\n})\nconst [email, password] = useFieldModel(['email', 'password'])\nconst { isSubmitted } = useValidation(submitCount)\n\nconst onInvalidSubmit = ({ errors }: InvalidSubmissionContext) =>\n  displayFirstError(errors)\n\nconst signIn = handleSubmit(async ({ email, password }) => {\n  const { data, error } = await auth.signInWithPassword({\n    email,\n    password,\n  })\n\n  if (error) {\n    toast.add({\n      severity: 'error',\n      summary: error.message,\n      life: 3000,\n    })\n  }\n\n  if (data.user) {\n    toast.add({\n      severity: 'success',\n      summary: 'You successfully logged in',\n      life: 3000,\n    })\n\n    await auth.updateUser({ email: data.user.email })\n  }\n}, onInvalidSubmit)\n\nwatchEffect(() => {\n  if (user.value) {\n    navigateTo('/')\n  }\n})\n</script>\n\n<template>\n  <div class=\"mb-8\">\n    <h1 class=\"Login\">Log in</h1>\n    <span>Please enter your details</span>\n  </div>\n\n  <form\n    class=\"flex flex-col\"\n    novalidate\n    @submit.prevent=\"signIn\"\n  >\n    <span class=\"mb-4 w-full\">\n      <label for=\"email\"> Email </label>\n      <InputText\n        id=\"email\"\n        v-model=\"email\"\n        data-testid=\"login-email-field\"\n        class=\"p-inputtext-lg md:w-25rem w-full\"\n        type=\"email\"\n        :class=\"[{ 'p-invalid': errors.email && isSubmitted }]\"\n        name=\"email\"\n      />\n      <small\n        v-if=\"errors.email && isSubmitted\"\n        class=\"p-error mt-1\"\n      >\n        {{ errors.email }}\n      </small>\n    </span>\n    <span class=\"mb-4 w-full\">\n      <label for=\"password\"> Password </label>\n      <Password\n        v-model=\"password\"\n        input-id=\"password\"\n        data-testid=\"login-password-field\"\n        class=\"p-inputtext-lg md:w-25rem w-full\"\n        :class=\"[{ 'p-invalid': errors.password && isSubmitted }]\"\n        input-class=\"w-full\"\n        :feedback=\"false\"\n        toggle-mask\n        :pt=\"{\n          input: {\n            name: 'password',\n          },\n        }\"\n      />\n      <small\n        v-if=\"errors.password && isSubmitted\"\n        class=\"p-error mt-1\"\n      >\n        {{ errors.password }}\n      </small>\n    </span>\n    <div class=\"mb-4 flex flex-wrap gap-3\">\n      <NuxtLink\n        to=\"reset-password\"\n        class=\"text-600 hover:text-primary transition-duration-300 ml-auto cursor-pointer transition-colors\"\n      >\n        Forgot your password?\n      </NuxtLink>\n    </div>\n    <Button\n      label=\"Log In\"\n      class=\"p-button-lg mb-4 w-full\"\n      type=\"submit\"\n      data-testid=\"login-submit-button\"\n    />\n    <p class=\"mt-4\">\n      Donâ€™t have an account yet? <NuxtLink to=\"/register\">Sign up</NuxtLink>\n    </p>\n  </form>\n</template>\n"],"names":["errors","email","password"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAWA,UAAM,OAAO;AACP,UAAA,EAAE,SAAS;AACjB,UAAM,QAAQ;AAEd,UAAM,EAAE,eAAe,cAAc,QAAQ,YAAA,IAAgB,QAAQ;AAAA,MACnE,kBAAkB;AAAA,IAAA,CACnB;AACK,UAAA,CAAC,OAAO,QAAQ,IAAI,cAAc,CAAC,SAAS,UAAU,CAAC;AAC7D,UAAM,EAAE,YAAA,IAAgB,cAAc,WAAW;AAEjD,UAAM,kBAAkB,CAAC,EAAE,QAAAA,QAAO,MAChC,kBAAkBA,OAAM;AAEX,iBAAa,OAAO,EAAE,OAAAC,QAAO,UAAAC,gBAAe;AACzD,YAAM,EAAE,MAAM,MAAU,IAAA,MAAM,KAAK,mBAAmB;AAAA,QACpD,OAAAD;AAAAA,QACA,UAAAC;AAAAA,MAAA,CACD;AAED,UAAI,OAAO;AACT,cAAM,IAAI;AAAA,UACR,UAAU;AAAA,UACV,SAAS,MAAM;AAAA,UACf,MAAM;AAAA,QAAA,CACP;AAAA,MACH;AAEA,UAAI,KAAK,MAAM;AACb,cAAM,IAAI;AAAA,UACR,UAAU;AAAA,UACV,SAAS;AAAA,UACT,MAAM;AAAA,QAAA,CACP;AAED,cAAM,KAAK,WAAW,EAAE,OAAO,KAAK,KAAK,OAAO;AAAA,MAClD;AAAA,OACC,eAAe;AAElB,gBAAY,MAAM;AAChB,UAAI,KAAK,OAAO;AACd,mBAAW,GAAG;AAAA,MAChB;AAAA,IAAA,CACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}