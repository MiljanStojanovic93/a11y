{"version":3,"file":"AuditProcessingDialog-e6f7122e.js","sources":["../../../../components/AuditProcessingDialog.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport { oneMinuteInMilliseconds } from 'utils/time'\n\nconst props = defineProps<{\n  auditId: number\n}>()\n\nconst client = useSupabaseClient()\nconst isAuditFinished = ref(false)\nconst axeErrorMessage = ref<string>()\n\nconst axeTableInsertChannel = client\n  .channel('table-db-changes')\n  .on(\n    'postgres_changes',\n    {\n      event: 'INSERT',\n      schema: 'public',\n      table: 'axe',\n    },\n    (payload) => {\n      if (payload.new.audit_id === props.auditId) {\n        if (payload.new.errors) {\n          axeErrorMessage.value = payload.new.errors[0]?.message\n        }\n        isAuditFinished.value = true\n        client.removeChannel(axeTableInsertChannel)\n        clearTimeout(timeout)\n      }\n    }\n  )\n  .subscribe()\n\nconst timeout = setTimeout(() => {\n  client.removeChannel(axeTableInsertChannel)\n  axeErrorMessage.value = 'Something went wrong, test malformed.'\n  isAuditFinished.value = true\n}, 15 * oneMinuteInMilliseconds)\n\ndefineEmits<{\n  (e: 'close', { resetAuditForm }?: { resetAuditForm: boolean }): void\n}>()\n</script>\n\n<template>\n  <Dialog\n    modal\n    class=\"w-full max-w-xl\"\n    dismissable-mask\n  >\n    <template #header>\n      <h2 class=\"font-medium\">New audit processing</h2>\n    </template>\n    <div aria-live=\"polite\">\n      <div\n        v-if=\"isAuditFinished\"\n        class=\"flex min-h-[200px] items-center justify-center\"\n      >\n        <div v-if=\"axeErrorMessage\">\n          <p class=\"mb-3\">\n            <span class=\"mb-3 block text-center text-lg text-red-700\">\n              Oops, something went wrong:\n            </span>\n            <span class=\"block whitespace-pre-line rounded-md bg-gray-100 p-4\">\n              {{ axeErrorMessage }}\n            </span>\n          </p>\n          <Button\n            class=\"!block !w-full\"\n            outlined\n            @click=\"$emit('close', { resetAuditForm: false })\"\n          >\n            Repeat audit\n          </Button>\n        </div>\n        <div v-else>\n          <p class=\"mb-6 text-center text-lg\">\n            Automatic tests finished successfully!\n          </p>\n          <NuxtLink\n            class=\"p-button !block\"\n            :to=\"`/audit/${auditId}`\"\n          >\n            View audit results\n          </NuxtLink>\n        </div>\n      </div>\n      <template v-else>\n        <p class=\"mb-6 text-center text-lg\">\n          Your audit has been initiated and is currently being processed. Please\n          wait a few minutes for automatic tests results to be generated. A link\n          to the audit results will be provided here and in the\n          <NuxtLink to=\"/audit\">Audit List</NuxtLink>.\n        </p>\n        <ProgressBar\n          class=\"mb-3\"\n          mode=\"indeterminate\"\n        />\n        <Button\n          class=\"!block !w-full\"\n          text\n          @click=\"$emit('close')\"\n        >\n          Create another audit in the meantime\n        </Button>\n      </template>\n    </div>\n  </Dialog>\n</template>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,UAAM,QAAQ;AAId,UAAM,SAAS;AACT,UAAA,kBAAkB,IAAI,KAAK;AACjC,UAAM,kBAAkB;AAExB,UAAM,wBAAwB,OAC3B,QAAQ,kBAAkB,EAC1B;AAAA,MACC;AAAA,MACA;AAAA,QACE,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,OAAO;AAAA,MACT;AAAA,MACA,CAAC,YAAY;;AACX,YAAI,QAAQ,IAAI,aAAa,MAAM,SAAS;AACtC,cAAA,QAAQ,IAAI,QAAQ;AACtB,4BAAgB,SAAQ,aAAQ,IAAI,OAAO,CAAC,MAApB,mBAAuB;AAAA,UACjD;AACA,0BAAgB,QAAQ;AACxB,iBAAO,cAAc,qBAAqB;AAC1C,uBAAa,OAAO;AAAA,QACtB;AAAA,MACF;AAAA,MAED,UAAU;AAEP,UAAA,UAAU,WAAW,MAAM;AAC/B,aAAO,cAAc,qBAAqB;AAC1C,sBAAgB,QAAQ;AACxB,sBAAgB,QAAQ;AAAA,IAAA,GACvB,KAAK,uBAAuB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}